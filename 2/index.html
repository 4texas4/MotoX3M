<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
<link rel="stylesheet" href="./assets/css/app.css" type="text/css" />
<title>Moto X3M 2 Unblocked</title>
<style>
  #level-editor {
    position: absolute;
    top: 10px; left: 10px;
    width: 300px; height: 400px;
    background: #222;
    color: #fff;
    padding: 10px;
    overflow: auto;
    z-index: 9999;
    font-family: monospace;
  }
  #level-editor textarea {
    width: 100%;
    height: 300px;
    background: #111;
    color: #fff;
    border: 1px solid #555;
    font-family: monospace;
  }
  #loader {
    display: none;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: white;
  }
</style>
</head>
<body>
<div id="content"></div>
<div id="orientation"></div>
<div id="loader">Loading ...</div>

<!-- Level editor -->
<div id="level-editor">
  <h3>Level JSON Editor</h3>
  <input type="file" id="fileInput"><br><br>
  <textarea id="jsonText"></textarea><br>
  <button id="loadLevelBtn">Load Level</button>
</div>

<script src="./assets/box2dweb/nape.min.js"></script>
<script src="./assets/box2dweb/nape-debug-draw.min.js"></script>
<script src="./assets/box2dweb/jquery-3.1.1.min.js"></script>
<script src="./assets/box2dweb/easeljs-0.8.2.combined.js"></script>
<script src="./assets/box2dweb/bluebird.min.js"></script>

<script>
// Hold the JSON before starting
let levelData = null;

// Load default JSON into the editor (but DO NOT start the game)
fetch('./assets/levels/1.json')
  .then(res => res.text())
  .then(text => {
    document.getElementById('jsonText').value = text;
    try { levelData = JSON.parse(text); } catch(e){ console.error(e); }
  });

// Pick local file
document.getElementById('fileInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    document.getElementById('jsonText').value = ev.target.result;
    try { levelData = JSON.parse(ev.target.result); alert('Level loaded!'); }
    catch(err){ alert('Invalid JSON!'); }
  };
  reader.readAsText(file);
});

// When ready, load level and start the game
document.getElementById('loadLevelBtn').addEventListener('click', () => {
  try {
    levelData = JSON.parse(document.getElementById('jsonText').value);
  } catch(err) {
    alert('Invalid JSON!');
    return;
  }

  // Hide editor, show loader
  document.getElementById('level-editor').style.display = 'none';
  document.getElementById('loader').style.display = 'block';

  // Expose the JSON globally so the game can use it
  window.customLevelJSON = levelData;

  // Now load your game script
  const script = document.createElement('script');
  script.src = './motox3m2.min.js?1489d20b164b3a2d04c4';
  document.body.appendChild(script);
});
</script>
</body>
</html>
